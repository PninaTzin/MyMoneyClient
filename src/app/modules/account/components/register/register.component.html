<div class="row" *ngIf="isPermission && user.id > 0">
    <div class="col-sm-9"></div>
    <div class="col-sm-3">
        נרשם ב : {{user.registerDate | date:"dd/MM/yyyy"}}
    </div>
</div>

<h4>{{title}}</h4>
<form #registerForm="ngForm" autocomplete="false">
    <br>
    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-envelope" viewBox="0 0 16 16">
                        <path
                            d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z" />
                    </svg>
                </span>
            </div>
            <input type="text" class="form-control" required email [(ngModel)]="user.email" #email="ngModel"
                name="email" placeholder="דואר אלקטרוני" autocomplete="new-email">
        </div>
        <div *ngIf="email.errors" class="text-danger">
            <span *ngIf="email.errors.required">*שדה חובה</span>
            <span *ngIf="email.errors.email">כתובת דואר אלקטרונית לא תקינה</span>
        </div>

    </div>
    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-person-fill" viewBox="0 0 16 16">
                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                    </svg>
                </span>
            </div>
            <input type="text" class="form-control" required [(ngModel)]="user.firstName" #fName="ngModel" name="fName"
                placeholder="שם פרטי">

        </div>
        <div class="text-danger">
            <span *ngIf="!fName.valid">*שדה חובה</span>
        </div>
    </div>
    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-person-fill" viewBox="0 0 16 16">
                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                    </svg>
                </span>
            </div>
            <input type="text" class="form-control" required [(ngModel)]="user.lastName" #lName="ngModel" name="lName"
                placeholder="שם משפחה">

        </div>
        <div class="text-danger">
            <span *ngIf="!lName.valid">*שדה חובה</span>
        </div>
    </div>
    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-telephone-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                    </svg>
                </span>
            </div>
            <input type="text" class="form-control" required minlength="9" [(ngModel)]="user.phone" #phone="ngModel"
                name="phone" placeholder="טלפון">
        </div>
        <div *ngIf="phone.errors" class="text-danger">
            <span *ngIf="phone.errors.required" class="text-danger">*שדה חובה</span>
            <span *ngIf="phone.errors.minlength" class="text-danger"> מספר טלפון קצר מידי</span>
        </div>
    </div>
    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-lock-fill" viewBox="0 0 16 16">
                        <path
                            d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" />
                    </svg>
                </span>
            </div>
            <input (appOnEnter)="save()" type="password" required minlength="6" class="form-control"
                [(ngModel)]="user.password" #pwd="ngModel" name="pwd" placeholder="סיסמה" autocomplete="new-password">
        </div>
        <div *ngIf="pwd.errors" class="text-danger">
            <span *ngIf="pwd.errors.required" class="text-danger">*שדה חובה</span>
            <span *ngIf="pwd.errors.minlength" class="text-danger"> סיסמה צריכה להכיל לפחות 6
                תווים</span>
        </div>
    </div>
    <div class="row" *ngIf="isPermission">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="32" fill="currentColor"
                        class="bi bi-person-fill-gear" viewBox="0 0 16 16">
                        <path
                            d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0m-9 8c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4m9.886-3.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0" />
                    </svg>
                </span>
            </div>
            <select class="form-control" name="selectUserTypes" [(ngModel)]="user.userType.id"
                (ngModelChange)="changeUserType($event)">
                <option selected [ngValue]="0" disabled>בחר סוג משתמש</option>
                <!-- אם הוא מנהל מערכת יכול להוסיף רק משתמש עצמאי או מנהל אירגון -->
                <option *ngFor="let uType of filteredUserTypes()" [ngValue]="uType.id">
                    {{uType.name}}
                </option>
            </select>


        </div>
        <div class="text-danger">
            <span *ngIf="user.userType.id==0" class="text-danger">*שדה חובה</span>
        </div>
    </div>
    <div class="row" *ngIf="isPermission &&(user.userType.id==5 ||user.userType.id==2) ">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="32" fill="currentColor"
                        class="bi bi-people-fill" viewBox="0 0 16 16">
                        <path
                            d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5" />
                    </svg>
                </span>
            </div>
            <select *ngIf="user.userType.id==5" class="form-control" #selecLenders="ngModel" name="selecLenders"
                [(ngModel)]="user.lender.id" (ngModelChange)="changeLender($event)">
                <option selected [ngValue]="undefined" disabled>בחר מלווה</option>
                <!-- [ngValue]="0" -->
                <option *ngFor="let lend of lenders" [ngValue]="lend.id">{{lend.name}}</option>
            </select>
            <select *ngIf="user.userType.id==2" class="form-control" #selecManager="ngModel" name="selecManager"
                [(ngModel)]="user.manager.id" (ngModelChange)="changeManager($event)">
                <option selected [ngValue]="0" disabled>בחר מנהל מלווים</option>
                <option *ngFor="let manager of managers" [ngValue]="manager.id">{{manager.name}}</option>
            </select>

        </div>
        <div class="text-danger">
            <span *ngIf="(user.lender.id==0&&user.userType.id==5) ||(user.userType.id==2&&user.manager.id==0)"
                class="text-danger">*שדה חובה</span>
        </div>
    </div>
    <div class="row" *ngIf="isLender">
        <span>שם המלווה</span>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="23" fill="currentColor"
                        class="bi bi-person-standing" viewBox="0 0 16 16">
                        <path
                            d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M6 6.75v8.5a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v2.75a.75.75 0 0 0 1.5 0v-2.5a.25.25 0 0 1 .5 0" />
                    </svg>
                </span>
            </div>
            <div class="form-control" name="lenderName"> {{currentUser.firstName}} {{currentUser.lastName}}
            </div>
        </div>
    </div>


    <label id="date-pay">
        תאריך תשלום
    </label>

    <div class="row">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="25" fill="currentColor"
                        class="bi bi-calendar2-fill" viewBox="0 0 16 16">
                        <path
                            d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4zM2.545 3h10.91c.3 0 .545.224.545.5v1c0 .276-.244.5-.546.5H2.545C2.245 5 2 4.776 2 4.5v-1c0-.276.244-.5.545-.5" />
                    </svg>
                </span>
            </div>

            <input type="date" class="form-control" [ngModel]="user.payDate | date:'yyyy-MM-dd'" #payDate="ngModel"
                name="payDate" (ngModelChange)="user.payDate = $event" placeholder="תאריך תשלום">

        </div>

    </div>

    <!--  -->
    <div class="row" *ngIf="isPermission && user.id > 0">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="27" fill="currentColor"
                        class="bi bi-cash-coin" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0" />
                        <path
                            d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z" />
                        <path
                            d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z" />
                        <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567" />
                    </svg>
                </span>
            </div>
            <div class="row form-group">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" [(ngModel)]="user.isYearlyPay" #yearly="ngModel" name="yearly">תשלום שנתי
                    </label>
                </div>
            </div>
        </div>

    </div>

    <div class="row" *ngIf="isPermission && user.id > 0">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="27" fill="currentColor"
                        class="bi bi-person-check-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M15.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0" />
                        <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                    </svg>
                </span>
            </div>
            <div class="row form-group">

                <div class="checkbox">
                    <label>
                        <input type="checkbox" [(ngModel)]="user.isActive" #active="ngModel" name="active">משתמש פעיל
                    </label>
                </div>

            </div>
        </div>

    </div>
    <div class="row" *ngIf="isPermission && user.id > 0">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="27" fill="currentColor"
                        class="bi bi-briefcase" viewBox="0 0 16 16">
                        <path
                            d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5m1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0M1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5" />
                    </svg>
                </span>
            </div>
            <div class="row form-group">

                <div class="checkbox">
                    <label>
                        <input type="checkbox" [(ngModel)]="user.isbusiness" #active="ngModel" name="active">חשבון עיסקי
                    </label>
                </div>

            </div>
        </div>

    </div>
    <div class="row">
        <div class="input-group mb-3">
            <label>
                <input type="checkbox" required [(ngModel)]="checkboxClick">
                המשתמש מאשר את תקנון האתר
            </label>
            <span id="link-terms" (click)="isClick = !isClick" style="margin-right: 1%">תקנון האתר</span>
        </div>
        <div class="text-danger">
            <span *ngIf="!checkboxClick" class="text-danger">*שדה חובה</span>
        </div>
        <p *ngIf="isClick"><br><app-terms></app-terms></p>
    </div>
    <div class="row form-group ">
        <div class="btn-group">
            <button type="button"
                [disabled]="registerForm.invalid ||user.userType.id==0|| (user.lender.id==0 && user.userType.id==6) ||(user.userType.id==2 && user.manager.id==0)"
                class="btn btn-primary " (click)="save()">שמור</button>
            <button type="button" class="btn btn-danger" (click)="cancel()">ביטול</button>
        </div>
    </div>
    <div class="row">
        <div *ngIf="id==null" class="text-lg-center">
            <a role="button" [routerLink]="'/account/login'">משתמש קיים? לדף הכניסה</a>
        </div>
    </div>

</form>